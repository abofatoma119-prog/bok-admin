
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم BOK - إدارة الحسابات</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #0056b3; --accent: #1e7e34; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 15px; margin: 0; }
        .card { background: white; width: 100%; max-width: 480px; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 2px solid #f0f0f0; margin-bottom: 20px; padding-bottom: 10px; }
        input { width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 16px; margin-bottom: 15px; text-align: center; outline: none; }
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-search { background: var(--primary); color: white; }
        
        .info-table { display: none; margin-top: 20px; background: #fafafa; border-radius: 15px; padding: 15px; border: 1px solid #eee; }
        .row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .row:last-child { border-bottom: none; }
        .label { color: #777; font-size: 14px; }
        .val { color: #333; font-weight: bold; }

        .balance-card { background: #e8f5e9; padding: 20px; border-radius: 15px; text-align: center; margin-top: 15px; border: 1px solid #c8e6c9; }
        .amount { font-size: 32px; font-weight: 900; color: var(--accent); margin: 5px 0; }
        .update-box { margin-top: 15px; display: flex; gap: 10px; }
        .update-input { margin-bottom: 0 !important; flex: 1; }
        .btn-add { background: var(--accent); color: white; width: auto; padding: 10px 20px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <h2 style="color: var(--primary); margin: 0;">نظام الاستعلام والتحديث</h2>
        <p style="font-size: 12px; color: #888;">جدول الحسابات: account_details</p>
    </div>

    <input type="text" id="target_acc" placeholder="أدخل رقم الحساب الكامل (16 رقم)">
    <button class="btn btn-search" onclick="searchAccount()">بحث عن البيانات</button>

    <div id="info_section" class="info-table">
        <div class="row"><span class="label">اسم الحساب:</span> <span id="view_name" class="val">-</span></div>
        <div class="row"><span class="label">نوع الحساب:</span> <span id="view_type" class="val">-</span></div>
        <div class="row"><span class="label">الفرع:</span> <span id="view_branch" class="val">-</span></div>
        <div class="row"><span class="label">الحساب المختصر:</span> <span id="view_short" class="val">-</span></div>

        <div class="balance-card">
            <div class="label">الرصيد المتاح</div>
            <div id="view_balance" class="amount">0.00 SDG</div>
            
            <div class="update-box">
                <input type="number" id="add_val" class="update-input" placeholder="إضافة مبلغ..">
                <button class="btn btn-add" onclick="updateBalance()">إضافة</button>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBR1lzuYqNUg1yRRdiNau4o6rjzpX8GjRo",
        authDomain: "ontest-92fe9.firebaseapp.com",
        databaseURL: "https://ontest-92fe9-default-rtdb.firebaseio.com",
        projectId: "ontest-92fe9",
        appId: "1:629491598570:android:fa1376f70fd64dd0c30393"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let userPath = "";
    let currentBal = 0;

    function searchAccount() {
        const acc = document.getElementById('target_acc').value;
        if(!acc) return alert("أدخل رقم الحساب أولاً");

        // البحث في جدول account_details بناءً على حقل full_account_number
        db.ref('account_details').orderByChild('full_account_number').equalTo(acc).once('value', (snapshot) => {
            if(snapshot.exists()) {
                snapshot.forEach(child => {
                    const data = child.val();
                    userPath = 'account_details/' + child.key;
                    currentBal = parseFloat(data.balance) || 0;

                    document.getElementById('view_name').innerText = data.name || "غير معروف";
                    document.getElementById('view_type').innerText = data.account_type || "جاري";
                    document.getElementById('view_branch').innerText = data.branch || "الرئيسي";
                    document.getElementById('view_short').innerText = data.short_account_number || "-";
                    document.getElementById('view_balance').innerText = currentBal.toLocaleString() + " SDG";
                    
                    document.getElementById('info_section').style.display = 'block';
                });
            } else {
                alert("رقم الحساب غير موجود في جدول account_details");
                document.getElementById('info_section').style.display = 'none';
            }
        });
    }

    function updateBalance() {
        const amount = parseFloat(document.getElementById('add_val').value);
        if(!amount || amount <= 0) return alert("أدخل مبلغ صحيح");

        const newTotal = currentBal + amount;
        db.ref(userPath).update({ balance: newTotal }).then(() => {
            alert("تمت عملية الزيادة بنجاح");
            searchAccount();
            document.getElementById('add_val').value = "";
        });
    }
</script>

</body>
</html>
