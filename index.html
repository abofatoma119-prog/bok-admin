<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOKA PANEL | Advanced Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', Tahoma, sans-serif; }
        .top-bar { background: #1a1a1a; color: #d4af37; padding: 15px; border-bottom: 2px solid #d4af37; }
        .card { border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 12px; }
        .log-screen { background: #000; color: #00ff00; font-family: monospace; padding: 10px; border-radius: 8px; font-size: 12px; height: 100px; overflow-y: auto; margin-bottom: 15px; text-align: left; direction: ltr; }
        .result-box { display: none; background: #e9ecef; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="top-bar mb-4 shadow d-flex justify-content-between container-fluid align-items-center">
    <h5 class="mb-0">MOKA PANEL | Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠ</h5>
    <div>
        <span class="badge bg-warning text-dark fs-6">Ù…ØªØµÙ„ Ø¨Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</span>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4">
                <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù…ÙŠÙ‚ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«</h6>
                
                <div id="log" class="log-screen">System Ready...</div>

                <div class="input-group mb-3">
                    <input type="text" id="acc_num" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨">
                    <button class="btn btn-primary" onclick="runSearch()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø«</button>
                </div>

                <div id="res_area" class="result-box">
                    <p class="small mb-1 text-muted">Ø§Ù„Ø§Ø³Ù…: <strong id="view_name" class="text-dark"></strong></p>
                    <p class="small mb-2 text-muted">Ø§Ù„Ø±ØµÙŠØ¯: <strong id="view_bal" class="text-success"></strong></p>
                    <hr>
                    <input type="number" id="new_amount" class="form-control mb-2" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¶Ø§Ù (+)">
                    <button class="btn btn-success w-100" onclick="runUpdate()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let activeAcc = "";

    function writeLog(msg) {
        const l = document.getElementById('log');
        l.innerHTML += "> " + msg + "<br>";
        l.scrollTop = l.scrollHeight;
    }

    function runSearch() {
        const acc = document.getElementById('acc_num').value;
        if(!acc) return;

        writeLog("Searching for account: " + acc);
        fetch('db_logic.php?action=search&acc=' + acc)
        .then(res => res.json())
        .then(data => {
            if(data.status === 'success') {
                activeAcc = acc;
                document.getElementById('view_name').innerText = data.full_name;
                document.getElementById('view_bal').innerText = data.balance.toLocaleString() + " SDG";
                document.getElementById('res_area').style.display = 'block';
                writeLog("SUCCESS: Data retrieved.");
            } else {
                writeLog("ERROR: Account not found.");
                alert("Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            }
        });
    }

    function runUpdate() {
        const amt = document.getElementById('new_amount').value;
        if(!amt || !activeAcc) return;

        writeLog("Processing update...");
        const params = new URLSearchParams();
        params.append('acc', activeAcc);
        params.append('amount', amt);

        fetch('db_logic.php?action=update', { method: 'POST', body: params })
        .then(res => res.json())
        .then(data => {
            if(data.status === 'success') {
                writeLog("DONE: Balance updated.");
                alert("ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­");
                runSearch();
            } else {
                writeLog("FAIL: Update rejected.");
            }
        });
    }
</script>
</body>
</html>
